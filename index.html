<html>
<head>
<title>Audio</title>
</head>
<body>
<!-- ref: https://developer.mozilla.org/en-US/docs/Web/HTML/Element/audio -->
<audio id="audioPlayer" src="">
Your browser does not support the <code>audio</code> element.
</audio><br />
<button id="play">Play</button>
<a href="#" id="prev">&lt; Prev</a>
&nbsp;&nbsp;&nbsp;
<a href="#" id="next">Next &gt;</a>
<br /><br />
Audio State: <div id="audioStateBox"></div><br />
Current Audio: <div id="currentAudioStateBox"></div><br />
Current Audio Time: <div id="currentAudioTimeBox"></div><br />
<script>
let currentSongIndex = 0;
let songs = [];
window.onload = function() {
    // Get song data
    // ref: https://developer.mozilla.org/en-US/docs/Web/API/Request
    const request = new Request('songs.json');
    fetch(request)
        .then(response => {
            if (response.status === 200) {
                return response.json();
            } else {
                throw new Error('Could not get song data.');
            }
        })
        .then(response => {
            songs = response['songs'];
        })
        .catch(error => {
            console.error(error);
        });
}

let audioState = 'stopped';
let audioStateBox = document.getElementById('audioStateBox');
let currentAudioTime = 0;
let currentAudioStateBox = document.getElementById('currentAudioStateBox');
let currentAudioTimeBox = document.getElementById('currentAudioTimeBox');
let audioPlayer = document.getElementById('audioPlayer');
let play = document.getElementById('play');
let prev = document.getElementById('prev');
let next = document.getElementById('next');

function getCurrentSongTime() {
    currentAudioTime = audioPlayer.currentTime;
    currentAudioTimeBox.innerHTML = Math.round(currentAudioTime);
}

// ref: https://developer.mozilla.org/en-US/docs/Web/API/HTMLMediaElement
play.addEventListener('click', event => {
    let timeChecking;
    audioPlayer.src = songs[currentSongIndex].url;
    currentAudioStateBox.innerHTML = songs[currentSongIndex].name;
    if (audioState === 'stopped' || audioState === 'paused') {
        audioPlayer.currentTime = currentAudioTime;
        audioState = 'playing';
        audioPlayer.play();
        // ref: https://developer.mozilla.org/en-US/docs/Web/API
        //   /WindowOrWorkerGlobalScope/setInterval
        timeChecking = setInterval(getCurrentSongTime, 1000);
    } else {
        audioPlayer.currentTime = currentAudioTime;
        audioState = 'paused';
        audioPlayer.pause();
        clearInterval(timeChecking);
    }
    audioStateBox.innerHTML = audioState;
});

audioPlayer.addEventListener('ended', event => {
    getNextSong();
    audioPlayer.play();
    currentAudioStateBox.innerHTML = songs[currentSongIndex].name;
});

next.addEventListener('click', event => {
    getNextSong();
});

function getNextSong() {
    if ((currentSongIndex + 1) < songs.length) {
        currentSongIndex++;
    } else {
        currentSongIndex = 0;
    }
    audioPlayer.src = songs[currentSongIndex].url;
}
</script>
</body>
</html>
